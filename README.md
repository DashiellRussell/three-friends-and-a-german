<p align="center">
  <img src="https://img.shields.io/badge/Hackathon-Mistral_AI_Worldwide_(Sydney)-ff7000?style=for-the-badge&logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHJ4PSI0IiBmaWxsPSIjZmY3MDAwIi8+PHRleHQgeD0iNSIgeT0iMTgiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9ImJvbGQiPk08L3RleHQ+PC9zdmc+" alt="Hackathon" />
</p>

<h1 align="center">Tessera</h1>
<h3 align="center">AI Health Companion</h3>

<p align="center">
  <em>Your health story, always ready.</em>
</p>

<p align="center">
  <img src="https://img.shields.io/badge/Next.js_16-000000?style=for-the-badge&logo=nextdotjs&logoColor=white" alt="Next.js" />
  <img src="https://img.shields.io/badge/React_19-61DAFB?style=for-the-badge&logo=react&logoColor=black" alt="React" />
  <img src="https://img.shields.io/badge/TypeScript-3178C6?style=for-the-badge&logo=typescript&logoColor=white" alt="TypeScript" />
  <img src="https://img.shields.io/badge/Tailwind_CSS_v4-06B6D4?style=for-the-badge&logo=tailwindcss&logoColor=white" alt="Tailwind CSS" />
  <img src="https://img.shields.io/badge/Express-000000?style=for-the-badge&logo=express&logoColor=white" alt="Express" />
</p>

<p align="center">
  <img src="https://img.shields.io/badge/Mistral_AI-ff7000?style=for-the-badge&logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHJ4PSI0IiBmaWxsPSIjZmY3MDAwIi8+PHRleHQgeD0iNSIgeT0iMTgiIGZvbnQtc2l6ZT0iMTYiIGZpbGw9IndoaXRlIiBmb250LWZhbWlseT0ic2Fucy1zZXJpZiIgZm9udC13ZWlnaHQ9ImJvbGQiPk08L3RleHQ+PC9zdmc+&logoColor=white" alt="Mistral AI" />
  <img src="https://img.shields.io/badge/Supabase-3FCF8E?style=for-the-badge&logo=supabase&logoColor=white" alt="Supabase" />
  <img src="https://img.shields.io/badge/ElevenLabs-000000?style=for-the-badge&logo=data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj48cmVjdCB4PSI4IiB5PSI0IiB3aWR0aD0iMyIgaGVpZ2h0PSIxNiIgZmlsbD0id2hpdGUiLz48cmVjdCB4PSIxMyIgeT0iNCIgd2lkdGg9IjMiIGhlaWdodD0iMTYiIGZpbGw9IndoaXRlIi8+PC9zdmc+&logoColor=white" alt="ElevenLabs" />
  <img src="https://img.shields.io/badge/Twilio-F22F46?style=for-the-badge&logo=twilio&logoColor=white" alt="Twilio" />
  <img src="https://img.shields.io/badge/Vercel-000000?style=for-the-badge&logo=vercel&logoColor=white" alt="Vercel" />
</p>

<p align="center">
  <img src="https://img.shields.io/badge/pgvector-4169E1?style=flat-square&logo=postgresql&logoColor=white" alt="pgvector" />
  <img src="https://img.shields.io/badge/shadcn/ui-000000?style=flat-square&logo=shadcnui&logoColor=white" alt="shadcn/ui" />
  <img src="https://img.shields.io/badge/Zod-3E67B1?style=flat-square&logo=zod&logoColor=white" alt="Zod" />
  <img src="https://img.shields.io/badge/jsPDF-red?style=flat-square" alt="jsPDF" />
  <img src="https://img.shields.io/badge/pnpm-F69220?style=flat-square&logo=pnpm&logoColor=white" alt="pnpm" />
  <img src="https://img.shields.io/badge/Railway-0B0D0E?style=flat-square&logo=railway&logoColor=white" alt="Railway" />
  <img src="https://img.shields.io/badge/WebRTC-333333?style=flat-square&logo=webrtc&logoColor=white" alt="WebRTC" />
</p>

---

## The Problem

Your doctor gets **10 minutes** every few months. Between appointments, symptoms go untracked, medication adherence slips, and warning signs get missed — especially for elderly and chronically ill patients who need monitoring most.

> *Your doctor gets 10 minutes. Tessera captures the other 10,070.*

## The Solution

Tessera is a voice-first AI health companion that turns everyday conversations into continuous, personalized health monitoring. It proactively calls you, understands natural speech, remembers your full health history with semantic search, and produces structured clinical output — bridging daily life and clinical care with zero friction.

---

## Features

<table>
<tr>
<td width="50%">

### Voice Check-ins
2-minute daily conversations that capture mood, symptoms, sleep, and medication — completely hands-free via real-time WebRTC streaming with ElevenLabs conversational AI.

</td>
<td width="50%">

### Proactive Outbound Calls
The app calls *you* for check-ins over the phone. No screen needed — just answer and talk. Powered by ElevenLabs + Twilio telephony integration.

</td>
</tr>
<tr>
<td width="50%">

### AI Text Conversations
Multi-turn chat check-ins powered by Mistral. The AI remembers your last 7 days of health context and asks personalized follow-up questions.

</td>
<td width="50%">

### Medical Document Analysis
Upload blood tests, prescriptions, or scans. Mistral AI extracts summaries and generates 1024-dim vector embeddings for semantic retrieval.

</td>
</tr>
<tr>
<td width="50%">

### Critical Symptom Flagging
Concerning symptom patterns trigger immediate alerts. Biased toward **false positives over false negatives** — designed to err on the side of caution.

</td>
<td width="50%">

### Health Trend Tracking
Energy, sleep, mood, and symptom frequency visualized over time with sparklines, bar charts, and AI-generated insight cards.

</td>
</tr>
<tr>
<td colspan="2" align="center">

### Doctor-Ready PDF Reports
One-page health briefs generated from your data — patient info, health metrics table, and AI executive summary. Print it or show it at your next appointment.

</td>
</tr>
</table>

---

## Architecture

```
┌──────────────────────────────────────────────────────────────────┐
│                          FRONTEND                                │
│       Next.js 16 · React 19 · Tailwind v4 · shadcn/ui           │
│       ElevenLabs WebRTC · jsPDF · Recharts                       │
├──────────────────────────────────────────────────────────────────┤
│                          BACKEND                                 │
│       Express · TypeScript · Zod · multer                        │
├────────────┬────────────┬────────────────┬───────────────────────┤
│  Mistral   │ ElevenLabs │    Twilio      │      Supabase         │
│    AI      │            │                │                       │
│ ┌────────┐ │ ┌────────┐ │ ┌────────────┐ │ ┌─────────────────┐  │
│ │ LLM    │ │ │ WebRTC │ │ │ Outbound   │ │ │ PostgreSQL      │  │
│ │ Embed  │ │ │ TTS    │ │ │ PSTN Calls │ │ │ pgvector        │  │
│ │ Struct │ │ │ Conv.  │ │ │            │ │ │ Auth + Storage  │  │
│ └────────┘ │ └────────┘ │ └────────────┘ │ └─────────────────┘  │
└────────────┴────────────┴────────────────┴───────────────────────┘
```

### Monorepo Structure

```
three-friends-and-a-german/
├── frontend/          Next.js app (pnpm)
│   └── src/
│       ├── app/           Pages & layouts
│       ├── components/    UI components (dashboard, log, trends, profile, input overlay)
│       └── lib/           Auth context, mock data, PDF generation
├── backend/           Express API server (npm)
│   └── src/
│       ├── routes/        REST endpoints (profiles, checkin, symptoms, documents, reports, voice)
│       ├── services/      External integrations (Mistral, Supabase, ElevenLabs)
│       └── middleware/    Auth & error handling
├── docs/              Project scope & schema diagrams
├── .vibe/             Mistral Vibe CLI agent profiles
└── DEPLOYMENT.md      Production deployment guide
```

---

## Mistral AI Integration

Mistral powers **every layer of intelligence** in Tessera. All LLM outputs use **Zod-validated structured output** for type-safe extraction.

| Function | Model | Purpose |
|:---------|:------|:--------|
| `embedText()` | `mistral-embed` | 1024-dim vectors for semantic health search via pgvector |
| `extractCheckinData()` | `mistral-large-latest` | Structured extraction: mood, energy, sleep, symptoms, flags |
| `generateConversationContext()` | `mistral-large-latest` | 7-day health summary as dynamic system prompt for voice AI |
| `summarizeDocument()` | `mistral-large-latest` | Medical document summarization (3-5 sentences) |
| `parseTranscriptWithMistral()` | `mistral-large-latest` | Outbound call transcript → structured check-in + symptoms |
| `generateChatOpener()` | `mistral-large-latest` | Personalized AI opening greeting for check-ins |
| `generateChatReply()` | `mistral-large-latest` | Multi-turn conversational health check-in replies |

### Mistral Vibe CLI Agents

4 specialized agent profiles in `.vibe/agents/`:

| Agent | Purpose |
|:------|:--------|
| Report Generation | Synthesize health timeline into structured doctor reports |
| Symptom Extraction | Parse voice transcripts into structured health data |
| Document Analysis | Process medical docs: chunk, embed, OCR, contextual summaries |
| Triage & Flagging | Evaluate symptom urgency, flag critical conditions |

---

## Key Data Flows

### Voice Check-in (WebRTC)
```
Frontend → GET /api/voice/signed-url → ElevenLabs WebRTC session
  ↕ User speaks ↔ AI responds (real-time bidirectional audio)
  → Frontend POST /api/checkin { transcript }
  → Mistral extractCheckinData() → structured JSON (mood, energy, sleep, symptoms)
  → Mistral embedText() → 1024-dim vector
  → Supabase check_ins + symptoms tables
```

### Proactive Outbound Call
```
POST /api/voice/outbound-call { phone_number }
  → Fetch recent check-ins + symptoms → build health context
  → ElevenLabs initiateOutboundCall() → Twilio rings user's phone
  → Background poll (15s interval, 15 min max)
  → On completion: syncCallFromElevenLabs()
  → parseTranscriptWithMistral() → auto-create check_in + symptoms
```

### Document Upload & Analysis
```
POST /api/documents/upload (multipart: file + document_text)
  → Store PDF to Supabase Storage (medical-documents bucket)
  → Mistral summarizeDocument() → AI summary
  → Mistral embedText() → 1024-dim vector
  → Insert document record with embedding
```

### Report Generation
```
GET /api/reports/generate?timeRange=week&detailLevel=summary
  → Fetch profile, check-ins, symptoms, documents in range
  → Mistral generates executive summary
  → jsPDF builds PDF (patient info, metrics table, AI summary)
  → Upload to Supabase Storage → return PDF to user
```

---

## Tech Stack

### Frontend

| Technology | Purpose |
|:-----------|:--------|
| ![Next.js](https://img.shields.io/badge/Next.js_16-000?style=flat-square&logo=nextdotjs&logoColor=white) | App Router, React Server Components, API routes |
| ![React](https://img.shields.io/badge/React_19-61DAFB?style=flat-square&logo=react&logoColor=black) | UI library with hooks and concurrent features |
| ![TypeScript](https://img.shields.io/badge/TypeScript-3178C6?style=flat-square&logo=typescript&logoColor=white) | Strict mode, full type safety |
| ![Tailwind](https://img.shields.io/badge/Tailwind_CSS_v4-06B6D4?style=flat-square&logo=tailwindcss&logoColor=white) | Utility-first styling via `@tailwindcss/postcss` |
| ![shadcn/ui](https://img.shields.io/badge/shadcn/ui-000?style=flat-square&logo=shadcnui&logoColor=white) | Accessible UI primitives |
| ![ElevenLabs](https://img.shields.io/badge/ElevenLabs_React-000?style=flat-square) | `@elevenlabs/react` WebRTC conversation hook |
| ![pnpm](https://img.shields.io/badge/pnpm-F69220?style=flat-square&logo=pnpm&logoColor=white) | Fast, disk-efficient package manager |

### Backend

| Technology | Purpose |
|:-----------|:--------|
| ![Express](https://img.shields.io/badge/Express_4.21-000?style=flat-square&logo=express&logoColor=white) | REST API framework |
| ![TypeScript](https://img.shields.io/badge/TypeScript-3178C6?style=flat-square&logo=typescript&logoColor=white) | End-to-end type safety |
| ![Mistral](https://img.shields.io/badge/Mistral_AI-ff7000?style=flat-square) | LLM structured extraction, embeddings, chat, summarization |
| ![Supabase](https://img.shields.io/badge/Supabase-3FCF8E?style=flat-square&logo=supabase&logoColor=white) | PostgreSQL + pgvector + Auth + Storage |
| ![Twilio](https://img.shields.io/badge/Twilio-F22F46?style=flat-square&logo=twilio&logoColor=white) | Outbound PSTN telephony |
| ![Zod](https://img.shields.io/badge/Zod_v4-3E67B1?style=flat-square&logo=zod&logoColor=white) | Runtime schema validation for LLM outputs |

### Infrastructure

| Technology | Purpose |
|:-----------|:--------|
| ![Vercel](https://img.shields.io/badge/Vercel-000?style=flat-square&logo=vercel&logoColor=white) | Frontend hosting with edge CDN |
| ![Railway](https://img.shields.io/badge/Railway-0B0D0E?style=flat-square&logo=railway&logoColor=white) | Backend hosting (long-running server) |
| ![Supabase](https://img.shields.io/badge/Supabase-3FCF8E?style=flat-square&logo=supabase&logoColor=white) | Managed PostgreSQL + pgvector + file storage |
| ![pgvector](https://img.shields.io/badge/pgvector-4169E1?style=flat-square&logo=postgresql&logoColor=white) | 1024-dim vector similarity search |

---

## Database Schema

7 tables with row-level security and pgvector embeddings:

```sql
profiles          -- User identity, health profile, onboarding state
check_ins         -- Daily health logs (mood, energy, sleep, transcript) + 1024-dim embedding
symptoms          -- Extracted symptoms with severity, criticality, alerts
documents         -- Uploaded medical docs with AI summary + 1024-dim embedding
document_chunks   -- RAG chunks for similarity search + 1024-dim embedding
reports           -- Generated PDF reports (pending → generating → completed)
outbound_calls    -- Phone call logs with ElevenLabs conversation + Twilio SIDs
```

**RPC functions:** `match_document_chunks()` and `match_check_ins()` power pgvector similarity search across all health data.

---

## API Overview

<details>
<summary><strong>Public Endpoints</strong> (no auth required)</summary>

| Method | Route | Description |
|:-------|:------|:------------|
| `GET` | `/ping` | Health check |
| `POST` | `/api/profiles/login` | Email-based login (find or create) |
| `POST` | `/api/voice/webhook/call-complete` | ElevenLabs webhook |
| `POST` | `/api/voice/backfill` | Admin: sync all incomplete calls |

</details>

<details>
<summary><strong>Check-ins & Chat</strong></summary>

| Method | Route | Description |
|:-------|:------|:------------|
| `GET` | `/api/checkin` | List check-ins (pagination) with nested symptoms |
| `GET` | `/api/checkin/:id` | Single check-in |
| `POST` | `/api/checkin` | Create from transcript (Mistral extraction + embedding) |
| `GET` | `/api/checkin/stats/summary` | Dashboard stats (avg energy, sleep, streak) |
| `POST` | `/api/checkin/summary` | Generate 7-day context for voice AI |
| `POST` | `/api/checkin/chat/start` | Start AI conversation |
| `POST` | `/api/checkin/chat/message` | Continue AI conversation |

</details>

<details>
<summary><strong>Symptoms</strong></summary>

| Method | Route | Description |
|:-------|:------|:------------|
| `GET` | `/api/symptoms` | List symptoms (filters: alerts_only, dismissed) |
| `GET` | `/api/symptoms/alerts` | Critical alerts only |
| `PATCH` | `/api/symptoms/:id/dismiss` | Dismiss alert |
| `GET` | `/api/symptoms/frequency` | Top symptoms by frequency |

</details>

<details>
<summary><strong>Documents</strong></summary>

| Method | Route | Description |
|:-------|:------|:------------|
| `GET` | `/api/documents` | List user documents |
| `GET` | `/api/documents/:id` | Single document |
| `POST` | `/api/documents/upload` | Upload + AI summarize + embed |

</details>

<details>
<summary><strong>Reports</strong></summary>

| Method | Route | Description |
|:-------|:------|:------------|
| `GET` | `/api/reports` | List reports |
| `GET` | `/api/reports/:id` | Single report |
| `POST` | `/api/reports` | Create report record (pending) |
| `GET` | `/api/reports/generate` | Generate + download PDF |

</details>

<details>
<summary><strong>Voice</strong></summary>

| Method | Route | Description |
|:-------|:------|:------------|
| `GET` | `/api/voice/signed-url` | ElevenLabs WebRTC signed URL + dynamic variables |
| `POST` | `/api/voice/outbound-call` | Initiate proactive health call |
| `GET` | `/api/voice/calls` | List outbound calls |
| `PATCH` | `/api/voice/calls/:id` | Update call record |
| `POST` | `/api/voice/sync-calls` | Fetch + sync call status from ElevenLabs |

</details>

---

## Getting Started

### Prerequisites

- **Node.js** 18+
- **pnpm** (frontend) and **npm** (backend)
- Accounts: [Supabase](https://supabase.com) | [Mistral AI](https://mistral.ai) | [ElevenLabs](https://elevenlabs.io) | [Twilio](https://twilio.com)

### 1. Clone & Install

```bash
git clone https://github.com/DashiellRussell/three-friends-and-a-german.git
cd three-friends-and-a-german

# Frontend
cd frontend && pnpm install

# Backend
cd ../backend && npm install
```

### 2. Environment Variables

<details>
<summary><strong>Backend</strong> — <code>backend/.env</code></summary>

```env
# Mistral AI
MISTRAL_API_KEY=

# Supabase
SUPABASE_URL=
SUPABASE_SERVICE_ROLE_KEY=

# ElevenLabs
ELEVENLABS_API_KEY=
ELEVENLABS_AGENT_ID=              # WebRTC voice check-in agent
ELEVENLABS_OUTBOUND_AGENT_ID=     # Phone call agent
ELEVENLABS_PHONE_NUMBER_ID=

# Twilio
TWILIO_ACCOUNT_SID=
TWILIO_AUTH_TOKEN=
TWILIO_PHONE_NUMBER=

# Server
PORT=3001
FRONTEND_URL=http://localhost:3000
```

</details>

<details>
<summary><strong>Frontend</strong> — <code>frontend/.env.local</code></summary>

```env
NEXT_PUBLIC_BACKEND_URL=http://localhost:3001
NEXT_PUBLIC_SUPABASE_URL=
NEXT_PUBLIC_SUPABASE_ANON_KEY=
```

</details>

### 3. Database Setup

Run `backend/schema.sql` in your [Supabase SQL Editor](https://supabase.com/dashboard) to create all 7 tables, RLS policies, pgvector indexes, and RPC functions.

### 4. Run

```bash
# Terminal 1 — Backend
cd backend && npm run dev      # http://localhost:3001

# Terminal 2 — Frontend
cd frontend && pnpm dev        # http://localhost:3000
```

---

## Deployment

| Service | Platform | Cost |
|:--------|:---------|:-----|
| Frontend | ![Vercel](https://img.shields.io/badge/Vercel-000?style=flat-square&logo=vercel&logoColor=white) Hobby | Free |
| Backend | ![Railway](https://img.shields.io/badge/Railway-0B0D0E?style=flat-square&logo=railway&logoColor=white) Hobby | $0–5/mo |
| Database | ![Supabase](https://img.shields.io/badge/Supabase-3FCF8E?style=flat-square&logo=supabase&logoColor=white) Free tier | Free |
| Voice AI | ElevenLabs Creator | ~$22/mo |
| Telephony | ![Twilio](https://img.shields.io/badge/Twilio-F22F46?style=flat-square&logo=twilio&logoColor=white) Pay-as-you-go | ~$2–7 |
| **Total** | | **~$25–35/mo** |

See **[DEPLOYMENT.md](./DEPLOYMENT.md)** for the full production deployment guide.

---

## Frontend UI

The demo app features a **mobile-first design** (430px container) with 4 main tabs:

| Tab | Features |
|:----|:---------|
| **Dashboard** | Time-based greeting, daily check-in CTA, alert cards, stat cards (streak, energy avg, adherence), energy sparkline |
| **Log** | 3 subtabs — check-in history, uploaded files, generated reports. Expandable entries with full transcripts |
| **Trends** | Energy/sleep/mood sparklines, mood distribution chart, symptom frequency, medication adherence, AI insight card |
| **Profile** | Health profile, document listing, check-in preferences, "call me" button, notification toggles |

**Input Overlay** supports 4 modes:
- Voice (WebRTC with animated status orb)
- Calling (outbound call with status progression)
- Chat (text-based AI conversation)
- Upload (drag-and-drop with progress indicator)

---

## Team

**Three Friends and a German** — Mistral AI Worldwide Hackathon, Sydney 2025

---

<p align="center">
  <sub>Tessera is a health monitoring companion and <strong>does not provide medical diagnoses</strong>. Always consult a qualified healthcare professional for medical advice. Critical symptom flagging is biased toward false positives — it is designed to err on the side of caution.</sub>
</p>
